{"ast":null,"code":"var _jsxFileName = \"/Users/christopher/Documents/vschoolwork/assignments/rtv/client/my-app/src/context/UserProvider.js\";\nimport React, { useState, useCallback } from \"react\";\nimport axios from \"axios\";\nexport const UserContext = React.createContext();\nconst initState = {\n  user: JSON.parse(localStorage.getItem(\"user\")) || {},\n  token: localStorage.getItem(\"token\") || \"\",\n  errMsg: \"\",\n  userWatchList: []\n};\nconst userAxios = axios.create();\nuserAxios.interceptors.request.use(config => {\n  config.headers.Authorization = `Bearer ${localStorage.getItem(\"token\")}`;\n  return config;\n});\nexport default function UserProvider(props) {\n  const [userState, setUserState] = useState(initState);\n\n  const signup = credentials => {\n    axios.post(\"/auth/signup\", credentials).then(res => {\n      const {\n        user,\n        token\n      } = res.data;\n      localStorage.setItem(\"user\", JSON.stringify(user));\n      localStorage.setItem(\"token\", token);\n      setUserState(prev => ({ ...prev,\n        user,\n        token,\n        errMsg: \"\"\n      }));\n    }).catch(err => handleAuthErr(err.response.data.errMsg));\n  };\n\n  const login = credentials => {\n    axios.post(\"/auth/login\", credentials).then(res => {\n      const {\n        user,\n        token\n      } = res.data;\n      localStorage.setItem(\"user\", JSON.stringify(user));\n      localStorage.setItem(\"token\", token);\n      setUserState(prev => ({ ...prev,\n        user,\n        token,\n        errMsg: \"\"\n      }));\n    }).catch(err => handleAuthErr(err.response.data.errMsg));\n  };\n\n  const logout = () => {\n    localStorage.removeItem(\"user\");\n    localStorage.removeItem(\"token\");\n    setUserState({\n      user: {},\n      token: \"\",\n      errMsg: \"\",\n      userWatchList: []\n    });\n  };\n\n  const getWatchList = useCallback(() => {\n    userAxios.get(\"/api/user/watchlist\").then(res => {\n      setUserState(prev => ({ ...prev,\n        userWatchList: res.data\n      }));\n    }).catch(err => console.log(err));\n  }, []);\n\n  const addToWatchList = _id => {\n    userAxios.put(`/api/user/watchlist/add/${_id}`).then(res => {\n      setUserState(p => ({ ...p,\n        user: res.data\n      }));\n      localStorage.setItem(\"user\", JSON.stringify(res.data));\n    }).catch(err => console.log(err));\n  };\n\n  const removeFromWatchList = _id => {\n    userAxios.put(`/api/user/watchlist/remove/${_id}`).then(res => {\n      setUserState(p => ({ ...p,\n        user: res.data,\n        userWatchList: p.userWatchList.filter(item => item._id !== _id)\n      }));\n      localStorage.setItem(\"user\", JSON.stringify(res.data));\n    }).catch(err => console.log(err));\n  };\n\n  const handleAuthErr = err => setUserState(p => ({ ...p,\n    errMsg: err\n  }));\n\n  const clearErrMsg = () => setUserState(p => ({ ...p,\n    errMsg: \"\"\n  }));\n\n  return /*#__PURE__*/React.createElement(UserContext.Provider, {\n    value: { ...userState,\n      login,\n      signup,\n      clearErrMsg,\n      logout,\n      addToWatchList,\n      removeFromWatchList,\n      getWatchList\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 5\n    }\n  }, props.children);\n}","map":{"version":3,"sources":["/Users/christopher/Documents/vschoolwork/assignments/rtv/client/my-app/src/context/UserProvider.js"],"names":["React","useState","useCallback","axios","UserContext","createContext","initState","user","JSON","parse","localStorage","getItem","token","errMsg","userWatchList","userAxios","create","interceptors","request","use","config","headers","Authorization","UserProvider","props","userState","setUserState","signup","credentials","post","then","res","data","setItem","stringify","prev","catch","err","handleAuthErr","response","login","logout","removeItem","getWatchList","get","console","log","addToWatchList","_id","put","p","removeFromWatchList","filter","item","clearErrMsg","children"],"mappings":"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","sourcesContent":["import React, { useState, useCallback } from \"react\";\nimport axios from \"axios\";\n\nexport const UserContext = React.createContext();\n\nconst initState = {\n  user: JSON.parse(localStorage.getItem(\"user\")) || {},\n  token: localStorage.getItem(\"token\") || \"\",\n  errMsg: \"\",\n  userWatchList: []\n};\n\nconst userAxios = axios.create();\nuserAxios.interceptors.request.use(config => {\n  config.headers.Authorization = `Bearer ${localStorage.getItem(\"token\")}`;\n  return config;\n});\n\nexport default function UserProvider(props) {\n  const [userState, setUserState] = useState(initState);\n\n  const signup = credentials => {\n    axios\n      .post(\"/auth/signup\", credentials)\n      .then(res => {\n        const { user, token } = res.data;\n        localStorage.setItem(\"user\", JSON.stringify(user));\n        localStorage.setItem(\"token\", token);\n        setUserState(prev => ({ ...prev, user, token, errMsg: \"\" }));\n      })\n      .catch(err => handleAuthErr(err.response.data.errMsg));\n  };\n\n  const login = credentials => {\n    axios\n      .post(\"/auth/login\", credentials)\n      .then(res => {\n        const { user, token } = res.data;\n        localStorage.setItem(\"user\", JSON.stringify(user));\n        localStorage.setItem(\"token\", token);\n        setUserState(prev => ({ ...prev, user, token, errMsg: \"\" }));\n      })\n      .catch(err => handleAuthErr(err.response.data.errMsg));\n  };\n\n  const logout = () => {\n    localStorage.removeItem(\"user\");\n    localStorage.removeItem(\"token\");\n    setUserState({ user: {}, token: \"\", errMsg: \"\", userWatchList: [] });\n  };\n\n  const getWatchList = useCallback(() => {\n    userAxios\n      .get(\"/api/user/watchlist\")\n      .then(res => {\n        setUserState(prev => ({ ...prev, userWatchList: res.data }));\n      })\n      .catch(err => console.log(err));\n  }, []);\n\n  const addToWatchList = _id => {\n    userAxios\n      .put(`/api/user/watchlist/add/${_id}`)\n      .then(res => {\n        setUserState(p => ({ ...p, user: res.data }));\n        localStorage.setItem(\"user\", JSON.stringify(res.data));\n      })\n      .catch(err => console.log(err));\n  };\n\n  const removeFromWatchList = _id => {\n    userAxios\n      .put(`/api/user/watchlist/remove/${_id}`)\n      .then(res => {\n        setUserState(p => ({ \n          ...p, \n          user: res.data,\n          userWatchList: p.userWatchList.filter(item => item._id !== _id) \n        }));\n        localStorage.setItem(\"user\", JSON.stringify(res.data));\n      })\n      .catch(err => console.log(err));\n  };\n\n  const handleAuthErr = err => setUserState(p => ({ ...p, errMsg: err }));\n  const clearErrMsg = () => setUserState(p => ({ ...p, errMsg: \"\" }));\n\n  return (\n    <UserContext.Provider\n      value={{\n        ...userState,\n        login,\n        signup,\n        clearErrMsg,\n        logout,\n        addToWatchList,\n        removeFromWatchList,\n        getWatchList\n      }}\n    >\n      {props.children}\n    </UserContext.Provider>\n  );\n}"]},"metadata":{},"sourceType":"module"}